# Project: adams
# Date: 2014-02-12 15:07:24
# User: fracpete
#
adams.flow.control.Flow
	-annotation
	Flow for collecting any tweets that can be obtained when\nlistening to the public tweet \"garden hose\". The tweets\nget collected in CSV files, one per day (\"day\" as defined \nby current locale) in the temp directory.\n\nWARNING: Collection continues, until the flow is stopped.
	-actor
		adams.flow.standalone.TwitterConnection
	-actor
		adams.flow.standalone.CallableActors
			-actor
				adams.flow.source.SequenceSource
					-name
					filename
					-annotation
					Here the CSV filename is generated
					-actor
						adams.flow.source.Start
					-actor
						adams.flow.transformer.Timestamp
							-format
							'${TMP}/tweets_'yyyy-MM-dd'.csv'
			-actor
				adams.flow.sink.Display
					-name
					Progress
	-actor
		adams.flow.source.TwitterListener
			-max-updates
			0
	-actor
		adams.flow.control.TriggerOnce
			-name
			initial filename
			-tee
				adams.flow.source.CallableSource
					-callable
					filename
			-tee
				adams.flow.transformer.SetVariable
					-name
					initial filename
					-var-name
					filename
	-actor
		adams.flow.control.Count
			-tee
				adams.flow.sink.CallableSink
					-callable
					Progress
			-condition
				adams.flow.condition.bool.Counting
					-interval
					1000
	-actor
		adams.flow.control.ConditionalTrigger
			-tee
				adams.flow.source.CallableSource
					-callable
					filename
			-tee
				adams.flow.control.ConditionalTee
					-annotation
					New CSV file started?
					-tee
						adams.flow.transformer.SetVariable
							-name
							new filename
							-var-name
							filename
					-condition
						adams.flow.condition.bool.Expression
							-expression
							\"@{filename}\" != \"X\"
			-condition
				adams.flow.condition.bool.Counting
					-interval
					1000
	-actor
		adams.flow.transformer.TwitterConverter
			-converter
				adams.data.twitter.SpreadSheetConverter
					-field
					ID
					-field
					USER_ID
					-field
					USER_NAME
					-field
					SOURCE
					-field
					TEXT
					-field
					CREATED
					-field
					FAVORITED
					-field
					RETWEET
					-field
					RETWEET_COUNT
					-field
					RETWEET_BY_ME
					-field
					POSSIBLY_SENSITIVE
					-field
					GEO_LATITUDE
					-field
					GEO_LONGITUDE
					-field
					LANGUAGE_CODE
					-field
					PLACE
					-field
					PLACE_TYPE
					-field
					PLACE_URL
					-field
					STREET_ADDRESS
					-field
					COUNTRY
					-field
					COUNTRY_CODE
					-field
					IN_REPLY_TO_STATUS_ID
					-field
					IN_REPLY_TO_USER_ID
					-field
					RETWEETED_STATUS_ID
					-field
					RETWEETED_STATUS_USER_ID
					-field
					RETWEETED_STATUS_CREATED
					-field
					EXPANDED_URLS
					-spreadsheet-type
						adams.data.spreadsheet.SpreadSheet
	-actor
		adams.flow.sink.SpreadSheetFileWriter
			-output
			@{filename}
			-writer
				adams.data.io.output.CsvSpreadSheetWriter
					-appending
					true
	-error-handling
	ACTORS_DECIDE_TO_STOP_ON_ERROR
	-flow-execution-listener
		adams.flow.execution.NullListener

